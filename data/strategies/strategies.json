{
  "strategies": [
    {
      "name": "test",
      "description": "test",
      "pythonCode": "def calculate(data, parameters):\n    \"\"\"\n    Calculate trading signals from stock data.\n\n    Args:\n        data: pandas DataFrame with columns:\n            - date (datetime)\n            - open, high, low, close, volume (float)\n            - All existing indicators\n        parameters: dict of configurable parameters\n\n    Returns:\n        list of dicts with format:\n        [\n            {\n                'date': '2024-01-01',\n                'type': 'v' or 'a',\n                'amount': 100,\n                'execution': 'close' or 'next_open'  # Optional\n            },\n            ...\n        ]\n        - 'type': 'v' for value-based (dollar amount), 'a' for amount-based (share count)\n        - 'amount': positive for buying, negative for selling\n        - 'execution': (optional) 'close' = execute at same day close (default, immediate)\n                                  'next_open' = execute at next day open (realistic, overnight gap)\n    \"\"\"\n    signals = []\n\n    # Example: Simple moving average crossover strategy\n    # Buy when short MA crosses above long MA\n    # Sell when short MA crosses below long MA\n\n    short_window = parameters.get('short_window', 10)\n    long_window = parameters.get('long_window', 30)\n\n    data['short_ma'] = data['close'].rolling(short_window).mean()\n    data['long_ma'] = data['close'].rolling(long_window).mean()\n\n    for i in range(1, len(data)):\n        prev_short = data['short_ma'].iloc[i-1]\n        prev_long = data['long_ma'].iloc[i-1]\n        curr_short = data['short_ma'].iloc[i]\n        curr_long = data['long_ma'].iloc[i]\n\n        # Golden cross: buy signal\n        if prev_short <= prev_long and curr_short > curr_long:\n            signals.append({\n                'date': data.index[i].strftime('%Y-%m-%d'),\n                'type': 'v',  # value-based (dollar amount)\n                'amount': 10000,  # Buy $10000 worth\n                'execution': 'next_open'  # Execute at next day's open (realistic)\n            })\n\n        # Death cross: sell signal\n        elif prev_short >= prev_long and curr_short < curr_long:\n            signals.append({\n                'date': data.index[i].strftime('%Y-%m-%d'),\n                'type': 'v',  # value-based (dollar amount)\n                'amount': -10000,  # Sell $10000 worth\n                'execution': 'next_open'  # Execute at next day's open (realistic)\n            })\n\n    return signals",
      "parameters": {},
      "id": "4a7fdff7-7f89-47d8-8602-63c26216f568",
      "createdAt": "2026-01-05T18:53:19.566Z",
      "strategyType": "single"
    },
    {
      "name": "mtest",
      "description": "test",
      "pythonCode": "def calculate(data_map, parameters):\n    \"\"\"\n    MACD Portfolio Rotation Strategy\n\n    Multi-stock portfolio with shared capital.\n    - Rebalances monthly based on MACD signals\n    - Ranks stocks by MACD momentum (DIF - DEA)\n    - Holds top 3 stocks with bullish MACD signals\n    - Rotates capital into strongest momentum stocks\n\n    Args:\n        data_map: Dict[str, pd.DataFrame] - {symbol: OHLC data}\n                  Each DataFrame has columns: date, open, high, low, close, volume\n                  And MACD indicators: MACD:DIF, MACD:DEA, MACD:MACD\n        parameters: dict of configurable parameters\n\n    Returns:\n        List of signals with 'symbol' field:\n        [\n            {\n                'date': '2024-01-01',\n                'symbol': '000001',  # REQUIRED for portfolio strategies\n                'type': 'v',         # 'v' for value-based, 'a' for amount-based\n                'amount': 10000,     # Positive = buy, negative = sell\n                'execution': 'next_open'  # Optional: 'close' or 'next_open'\n            },\n            ...\n        ]\n    \"\"\"\n    signals = []\n\n    # Parameters\n    top_n = parameters.get('top_stocks', 3)\n    rebalance_days = parameters.get('rebalance_days', 21)  # Monthly rebalancing\n    position_size = parameters.get('position_size', 30000)\n\n    # Get reference dates from first symbol\n    first_symbol = list(data_map.keys())[0]\n    all_dates = data_map[first_symbol].index\n\n    # Track current holdings\n    current_holdings = set()\n\n    # Loop through dates and rebalance periodically\n    for i in range(40, len(all_dates), rebalance_days):  # Start at day 40 (MACD needs ~35 days)\n        current_date = all_dates[i]\n\n        # Calculate MACD momentum for each stock\n        macd_scores = {}\n        for symbol, df in data_map.items():\n            if i >= len(df):\n                continue\n\n            try:\n                # Get MACD values at this date and convert to float\n                dif = float(df['MACD:DIF'].iloc[i])\n                dea = float(df['MACD:DEA'].iloc[i])\n                macd_hist = float(df['MACD:MACD'].iloc[i])\n\n                # Skip if NaN\n                if pd.isna(dif) or pd.isna(dea) or pd.isna(macd_hist):\n                    continue\n\n                # MACD momentum score: use histogram and check if DIF > DEA\n                is_bullish = dif > dea\n                momentum = macd_hist if is_bullish else -abs(macd_hist)\n\n                macd_scores[symbol] = momentum\n            except (KeyError, IndexError, ValueError, TypeError):\n                continue\n\n        if not macd_scores:\n            continue\n\n        # Rank stocks by MACD momentum\n        ranked_symbols = sorted(macd_scores.items(), key=lambda x: x[1], reverse=True)\n\n        # Select top N stocks with positive momentum\n        target_holdings = set()\n        for symbol, momentum in ranked_symbols[:top_n]:\n            if momentum > 0:  # Only hold stocks with bullish MACD\n                target_holdings.add(symbol)\n\n        # Sell stocks no longer in top picks\n        to_sell = current_holdings - target_holdings\n        for symbol in to_sell:\n            signals.append({\n                'date': current_date.strftime('%Y-%m-%d'),\n                'symbol': symbol,\n                'type': 'v',\n                'amount': -position_size,\n                'execution': 'next_open'\n            })\n\n        # Buy new top picks\n        to_buy = target_holdings - current_holdings\n        for symbol in to_buy:\n            signals.append({\n                'date': current_date.strftime('%Y-%m-%d'),\n                'symbol': symbol,\n                'type': 'v',\n                'amount': position_size,\n                'execution': 'next_open'\n            })\n\n        # Update holdings\n        current_holdings = target_holdings\n\n    return signals",
      "strategyType": "portfolio",
      "parameters": {},
      "constraints": {
        "maxPositions": 5,
        "positionSizing": "equal",
        "reserveCash": 10
      },
      "id": "776b910c-de94-4436-9c5b-1e7f0050026c",
      "createdAt": "2026-01-06T17:09:19.067Z"
    }
  ]
}